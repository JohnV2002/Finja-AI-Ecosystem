<!-- ====================================================================== -->

<!--           Finja's Brain & Knowledge Core - 89.0 RTL                    -->

<!-- ====================================================================== -->

<!--                                                                        -->

<!--   Project: Finja - Twitch Interactivity Suite                          -->

<!--   Author: JohnV2002 (J. Apps / Sodakiller1)                            -->

<!--   Version: 1.0.0                                                       -->

<!--   Description: HTML für 89.0 RTL.                                      -->

<!--                                                                        -->

<!--   Copyright (c) 2025 J. Apps                                           -->

<!--   Licensed under the MIT License.                                      -->

<!-- ====================================================================== -->


<!DOCTYPE html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>89.0 RTL – Now Playing (Stacked)</title>
<style>
  html, body { margin:0; background:transparent; }
  :root{
    --x: 24px; --y: 24px; --maxw: 820px;
    --rtl-red:#e30613; --rtl-gold:#ffcc00; --finja-a:#7aa2ff; --finja-b:#ff6ad5;
    --panel-bg: rgba(255,255,255,.72); --panel-border: rgba(0,0,0,.10);
    --txt:#0b1020; --txt-sub:#334155;
    --glow-1:#e30613; --glow-2:#ffcc00; --glow-3:#7aa2ff; --glow-4:#ff6ad5;
  }
  .card{ position: fixed; left:var(--x); top:var(--y); width:min(92vw,var(--maxw));
    box-sizing:border-box; padding:16px 18px; border-radius:16px; background:var(--panel-bg);
    backdrop-filter: blur(10px); border:1px solid var(--panel-border);
    box-shadow: 0 10px 30px rgba(0,0,0,.20), 0 0 0 2px rgba(255,255,255,.35) inset;
  }
  .card::before{ content:""; position:absolute; inset:-3px; border-radius:inherit;
    background: conic-gradient(from 180deg at 50% 50%, var(--glow-1), var(--glow-2), var(--glow-3), var(--glow-4), var(--glow-1));
    filter: blur(14px); opacity:.55; z-index:-1;
  }
  .head{ display:flex; align-items:center; gap:10px; margin-bottom:6px; flex-wrap:wrap; }
  .logo{ width:18px; height:18px; border-radius:50%;
    background: radial-gradient(circle at 35% 35%, #fff 0 25%, var(--rtl-gold) 26% 60%, var(--rtl-red) 61%);
    box-shadow: 0 0 10px rgba(227,6,19,.65), 0 0 16px rgba(255,204,0,.45);
    flex:0 0 18px;
  }
  .brand { display:flex; align-items:baseline; gap:10px; }
  .sub{ font:800 13px/1 system-ui, Segoe UI, Roboto, Arial, sans-serif; letter-spacing:.10em; text-transform:uppercase; color:var(--txt-sub); white-space:nowrap; }
  /* NEU: weicher Hinweis rechts neben Label */
  .note{ font:600 12px/1.2 system-ui, Segoe UI, Roboto, Arial, sans-serif; color:#475569; opacity:.9; white-space:nowrap; }
  .dot{ display:inline-block; width:4px; height:4px; border-radius:50%; background:#94a3b8; margin:0 8px; opacity:.9; vertical-align:middle; }

  .title{ margin:2px 0 10px 0; color:var(--txt); font:800 26px/1.25 system-ui, Segoe UI, Roboto, Arial, sans-serif;
    text-shadow:0 0 6px rgba(255,255,255,.35); word-break:break-word; overflow-wrap:anywhere;
  }

  .chips{ display:flex; flex-wrap:wrap; gap:8px; margin:0 0 10px 0; align-items:center; }
  .chip{ padding:6px 10px; border-radius:12px; background:rgba(11,16,32,.06); border:1px solid rgba(11,16,32,.08);
    color:var(--txt); font:800 14px/1.2 system-ui, Segoe UI, Roboto, Arial, sans-serif; text-shadow:0 1px 0 rgba(255,255,255,.45);
    user-select:none;
  }
  .chip--special{ background:rgba(255,255,255,.35); border:1px solid rgba(255,255,255,.95); }
  /* NEU: Wiederholungs-Badge */
  .chip--repeat{ background:rgba(227,6,19,.10); border-color:rgba(227,6,19,.25); }

  .react{ padding:10px 14px; border-radius:14px;
    background: linear-gradient(90deg, rgba(227,6,19,.14), rgba(255,204,0,.16), rgba(122,162,255,.18), rgba(255,106,213,.18));
    color:#0b1020; font:800 16px/1.35 system-ui, Segoe UI, Roboto, Arial, sans-serif; text-shadow:0 1px 0 rgba(255,255,255,.55);
    box-shadow:0 2px 8px rgba(0,0,0,.10); border:1px solid rgba(11,16,32,.10);
    max-width:min(70ch,88vw); white-space:normal; overflow-wrap:anywhere; word-break:break-word; transition:opacity .35s ease;
  }
  .react[hidden]{ display:none; } .fade-out{ opacity:0; }

  @media (max-width: 560px){
    .title{ font-size:22px; }
    .chip{ font-size:13px; padding:5px 8px; }
    .react{ font-size:14px; }
    .note{ font-size:11px; }
  }
</style>

<div class="card">
  <div class="head">
    <div class="logo"></div>
    <div class="brand">
      <div class="sub" id="label">89.0 RTL</div>
      <!-- NEU: Live-Hinweis -->
      <div class="note"><span class="dot"></span>Live-Daten von RTL – systembedingt 30 Sek. bis ca. 2 Min. Verzögerung möglich.</div>
    </div>
  </div>

  <div class="title" id="np">Lade…</div>

  <!-- NEU: Wiederholungs-Badge kommt hier rein -->
  <div class="chips" id="chips">
    <div class="chip chip--repeat" id="repeat" hidden>Wiederholung: 1×</div>
  </div>

  <div class="chips" id="genres"></div>
  <div class="react" id="react" hidden></div>
</div>

<script>
  (function init(){
    const p = new URLSearchParams(location.hash.replace(/^#/, ''));
    const setVar = (n,v)=> v!=null && document.documentElement.style.setProperty(n, v);
    if(p.get('x')) setVar('--x', p.get('x')+'px');
    if(p.get('y')) setVar('--y', p.get('y')+'px');
    if(p.get('maxw')) setVar('--maxw', p.get('maxw')+'px');
    if(p.get('label')) document.getElementById('label').textContent = p.get('label');
  })();

  async function read(path){
    try{
      const r = await fetch(path + (path.includes('?')?'&':'?') + 'ts=' + Date.now());
      if(!r.ok) throw 0;
      return (await r.text()).trim();
    }catch{ return ""; }
  }

  function splitParts(s){ return (s||"").split(/•|,|\|/g).map(x=>x.trim()).filter(Boolean); }
  const SPECIAL_RX = /^(nightcore|speed\s*up|sped\s*up|speedup|tiktok|tik\s*tok|radio\s*edit|radio\s*mix)$/i;

  function renderGenres(text){
    const box = document.getElementById('genres');
    box.innerHTML = "";
    if(!text) return;
    for(const p of splitParts(text)){
      const div = document.createElement('div');
      div.className = 'chip' + (SPECIAL_RX.test(p) ? ' chip--special' : '');
      div.textContent = p;
      box.appendChild(div);
    }
  }

  let lastReact="", lastNP="", lastGenres="", lastRepeat="";

  async function tick(){
    const np = await read('nowplaying.txt');
    if(np && np !== lastNP){
      document.getElementById('np').textContent = np;
      lastNP = np;
    }else if(!np && lastNP !== "—"){
      document.getElementById('np').textContent = "—";
      lastNP = "—";
    }

    const g = await read('outputs/obs_genres.txt');
    if(g !== lastGenres){ renderGenres(g); lastGenres = g; }

    const r = await read('outputs/obs_react.txt');
    const el = document.getElementById('react');
    if(!r){ el.hidden = true; lastReact=""; }
    else if(r !== lastReact){
      el.hidden = false; el.classList.add('fade-out');
      setTimeout(()=>{ el.textContent = "Finjas Antwort: " + r; el.classList.remove('fade-out'); lastReact = r; }, 120);
    }

    // NEU: Wiederholungs-Badge lesen
    const rep = await read('outputs/obs_repeat.txt');
    const repEl = document.getElementById('repeat');
    if(rep && rep !== lastRepeat){
      repEl.textContent = rep;
      repEl.hidden = false;
      lastRepeat = rep;
    }else if(!rep && !repEl.hidden){
      repEl.hidden = true;
      lastRepeat = "";
    }
  }
  tick();
  setInterval(tick, 1500);
</script>
